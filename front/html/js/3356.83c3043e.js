"use strict";(self["webpackChunks023"]=self["webpackChunks023"]||[]).push([[3356,8284],{5511:(t,e,s)=>{s.r(e),s.d(e,{default:()=>b});var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"search"},[e("Card",[e("Row",{attrs:{gutter:16}},[e("Col",{attrs:{span:"7"}},[e("Row",{attrs:{gutter:16}},[e("Col",{attrs:{span:"23"}},[e("div",{staticClass:"tree-bar",staticStyle:{"overflow-y":"scroll","padding-right":"50px"},style:{maxHeight:t.maxHeight+"px"}},[e("Tree",{ref:"tree",attrs:{data:t.data,"show-checkbox":"",render:t.renderContent,"check-strictly":!t.strict},on:{"on-select-change":t.selectTree,"on-check-change":t.changeSelect}}),t.loading?e("Spin",{attrs:{size:"large",fix:""}}):t._e()],1)])],1)],1),e("Col",{attrs:{span:"15"}},[e("Row",{staticClass:"operation"},[e("Col",{attrs:{span:"12"}},[e("Button",{attrs:{type:"primary",shape:"circle",ghost:"",icon:"md-add",disabled:!t.$route.meta.permTypes.includes("add")},on:{click:t.addMenu}},[t._v("添加菜单")]),e("Button",{attrs:{type:"error",shape:"circle",ghost:"",icon:"md-trash",disabled:!t.$route.meta.permTypes.includes("delete")},on:{click:t.deletePermissionFx}},[t._v("删除菜单")]),e("Button",{attrs:{type:"success",shape:"circle",ghost:"",icon:"md-trash"},on:{click:t.getPermissionList}},[t._v("刷新菜单")]),e("i-switch",{staticStyle:{"margin-left":"5px"},attrs:{size:"large"},model:{value:t.strict,callback:function(e){t.strict=e},expression:"strict"}},[e("span",{attrs:{slot:"open"},slot:"open"},[t._v("级联")]),e("span",{attrs:{slot:"close"},slot:"close"},[t._v("单选")])])],1),e("Col",{attrs:{span:"12"}},[e("Input",{attrs:{suffix:"ios-search",placeholder:"模拟搜索菜单",clearable:""},on:{"on-change":t.search},model:{value:t.searchKey,callback:function(e){t.searchKey=e},expression:"searchKey"}})],1)],1),e("Divider",{attrs:{dashed:""}}),e("Row",{directives:[{name:"show",rawName:"v-show",value:t.form.id,expression:"form.id"}],attrs:{gutter:16}},[e("Col",{attrs:{span:"24"}},[e("Alert",{attrs:{"show-icon":"",type:"success"}},[t._v(" 当前选择的菜单： "),e("span",{staticClass:"select-title"},[t._v(t._s(t.editTitle))]),e("Divider",{attrs:{type:"vertical"}}),e("a",{staticClass:"select-clear",on:{click:t.cancelEdit}},[t._v("取消选择")])],1)],1),e("Divider",{attrs:{dashed:""}})],1),e("Form",{ref:"form",attrs:{model:t.form,"label-width":130,rules:t.formValidate}},[e("Row",{attrs:{gutter:16}},[e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"类型",prop:"type"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:-1==t.form.type,expression:"form.type==-1"}]},[e("Icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"ios-navigate-outline",size:"16"}}),e("span",[t._v("一级菜单")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:0==t.form.type,expression:"form.type==0"}]},[e("Icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"ios-list-box-outline",size:"16"}}),e("span",[t._v("普通菜单")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:1==t.form.type,expression:"form.type==1"}]},[e("Icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"md-radio-button-on",size:"16"}}),e("span",[t._v("按钮级权限")])],1)])],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:-1==t.form.type||0==t.form.type,expression:"form.type==-1||form.type==0"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:"名称",prop:"title"}},[e("Input",{staticStyle:{width:"100%"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1)],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:1==t.form.type,expression:"form.type==1"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:"名称",prop:"title"}},[e("Input",{staticStyle:{width:"100%"},attrs:{placeholder:"操作按钮名称不得重复"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1)],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:0==t.form.type,expression:"form.type==0"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:"路径",prop:"path"}},[e("Input",{staticStyle:{width:"100%"},on:{"on-blur":t.changeFormPath},model:{value:t.form.path,callback:function(e){t.$set(t.form,"path",e)},expression:"form.path"}})],1)],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:1==t.form.type,expression:"form.type==1"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:"按钮权限类型",prop:"buttonType"}},[e("Select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择或输入搜索",filterable:"",clearable:""},model:{value:t.form.buttonType,callback:function(e){t.$set(t.form,"buttonType",e)},expression:"form.buttonType"}},t._l(t.dictPermissions,(function(s,o){return e("Option",{key:o,attrs:{value:s.value}},[t._v(t._s(s.title))])})),1)],1)],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:-1==t.form.type,expression:"form.type==-1"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:-1==t.form.type?"英文名":"路由英文名",prop:"name"}},[e("Input",{staticStyle:{width:"100%"},attrs:{placeholder:"需唯一"},on:{"on-blur":t.changeFormName},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:-1==t.form.type||0==t.form.type,expression:"form.type==-1||form.type==0"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:"图标",prop:"icon"}},[e("icon-choose",{model:{value:t.form.icon,callback:function(e){t.$set(t.form,"icon",e)},expression:"form.icon"}})],1)],1),e("Col",{directives:[{name:"show",rawName:"v-show",value:0==t.form.type,expression:"form.type==0"}],attrs:{span:"12"}},[e("FormItem",{attrs:{label:"对应位置",prop:"component"}},[e("Input",{staticStyle:{width:"100%"},model:{value:t.form.component,callback:function(e){t.$set(t.form,"component",e)},expression:"form.component"}})],1)],1),e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"排序值",prop:"sortOrder"}},[e("InputNumber",{staticStyle:{width:"100%"},attrs:{max:1e3,min:0},model:{value:t.form.sortOrder,callback:function(e){t.$set(t.form,"sortOrder",e)},expression:"form.sortOrder"}})],1)],1),e("Col",{attrs:{span:"12"}},[e("FormItem",{attrs:{label:"是否启用",prop:"status"}},[e("i-switch",{attrs:{size:"large","true-value":0,"false-value":-1},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[e("span",{attrs:{slot:"open"},slot:"open"},[t._v("启用")]),e("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁用")])])],1)],1),e("Col",{attrs:{span:"12"}},[e("Form-item",[e("Button",{staticStyle:{"margin-right":"5px"},attrs:{ghost:"",shape:"circle",loading:t.submitLoading,type:"primary",icon:"ios-create-outline",disabled:!t.$route.meta.permTypes.includes("edit")},on:{click:t.submitEdit}},[t._v("保存菜单")])],1)],1)],1)],1),e("Divider",[t._v("有 "+t._s(t.form.title)+" 权限的用户")]),e("Row",{attrs:{gutter:16}},[e("Table",{attrs:{loading:t.userByPermissionLoading,border:"",stripe:"",size:"small",columns:t.userByPermissionColumns,data:t.userByPermissionList}})],1)],1)],1)],1),e("Modal",{attrs:{draggable:"",title:t.modalTitle,mask:!1,width:500,styles:{top:"30px"}},model:{value:t.menuModalVisible,callback:function(e){t.menuModalVisible=e},expression:"menuModalVisible"}},[e("Form",{ref:"formAdd",attrs:{model:t.formAdd,"label-width":100,rules:t.formValidate}},[t.showParent?e("div",[e("FormItem",{attrs:{label:"上级节点："}},[t._v(t._s(t.parentTitle))])],1):t._e(),e("FormItem",{attrs:{label:"类型",prop:"type"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:-1==t.formAdd.type,expression:"formAdd.type==-1"}]},[e("Icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"ios-navigate-outline",size:"16"}}),e("span",[t._v("顶部菜单")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:0==t.formAdd.type,expression:"formAdd.type==0"}]},[e("Icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"ios-list-box-outline",size:"16"}}),e("span",[t._v("页面菜单")])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:1==t.formAdd.type,expression:"formAdd.type==1"}]},[e("Icon",{staticStyle:{"margin-right":"5px"},attrs:{type:"md-radio-button-on",size:"16"}}),e("span",[t._v("操作按钮")])],1)]),-1==t.formAdd.type||0==t.formAdd.type?e("FormItem",{attrs:{label:"名称",prop:"title"}},[e("Input",{model:{value:t.formAdd.title,callback:function(e){t.$set(t.formAdd,"title",e)},expression:"formAdd.title"}})],1):t._e(),1==t.formAdd.type?e("FormItem",{staticClass:"block-tool",attrs:{label:"名称",prop:"title"}},[e("Tooltip",{attrs:{placement:"right",content:"操作按钮名称不得重复"}},[e("Input",{model:{value:t.formAdd.title,callback:function(e){t.$set(t.formAdd,"title",e)},expression:"formAdd.title"}})],1)],1):t._e(),0==t.formAdd.type?e("FormItem",{attrs:{label:"路径",prop:"path"}},[e("Input",{model:{value:t.formAdd.path,callback:function(e){t.$set(t.formAdd,"path",e)},expression:"formAdd.path"}})],1):t._e(),1==t.formAdd.type?e("FormItem",{attrs:{label:"按钮权限类型",prop:"buttonType"}},[e("Select",{attrs:{placeholder:"请选择或输入搜索",filterable:"",clearable:""},model:{value:t.formAdd.buttonType,callback:function(e){t.$set(t.formAdd,"buttonType",e)},expression:"formAdd.buttonType"}},t._l(t.dictPermissions,(function(s,o){return e("Option",{key:o,attrs:{value:s.value}},[t._v(t._s(s.title))])})),1)],1):t._e(),-1==t.formAdd.type?e("FormItem",{staticClass:"block-tool",attrs:{label:"英文名",prop:"name"}},[e("Tooltip",{attrs:{placement:"right",content:"需唯一"}},[e("Input",{model:{value:t.formAdd.name,callback:function(e){t.$set(t.formAdd,"name",e)},expression:"formAdd.name"}})],1)],1):t._e(),0==t.formAdd.type?e("FormItem",{staticClass:"block-tool",attrs:{label:"路由英文名",prop:"name"}},[e("Tooltip",{attrs:{placement:"right",content:"需唯一"}},[e("Input",{model:{value:t.formAdd.name,callback:function(e){t.$set(t.formAdd,"name",e)},expression:"formAdd.name"}})],1)],1):t._e(),-1==t.formAdd.type||0==t.formAdd.type?e("FormItem",{attrs:{label:"图标",prop:"icon"}},[e("icon-choose",{model:{value:t.formAdd.icon,callback:function(e){t.$set(t.formAdd,"icon",e)},expression:"formAdd.icon"}})],1):t._e(),0==t.formAdd.type?e("FormItem",{attrs:{label:"对应位置",prop:"component"}},[e("Input",{model:{value:t.formAdd.component,callback:function(e){t.$set(t.formAdd,"component",e)},expression:"formAdd.component"}})],1):t._e(),e("FormItem",{attrs:{label:"排序值",prop:"sortOrder"}},[e("InputNumber",{attrs:{max:1e3,min:0},model:{value:t.formAdd.sortOrder,callback:function(e){t.$set(t.formAdd,"sortOrder",e)},expression:"formAdd.sortOrder"}})],1),e("FormItem",{attrs:{label:"是否启用",prop:"status"}},[e("i-switch",{attrs:{size:"large","true-value":0,"false-value":-1},model:{value:t.formAdd.status,callback:function(e){t.$set(t.formAdd,"status",e)},expression:"formAdd.status"}},[e("span",{attrs:{slot:"open"},slot:"open"},[t._v("启用")]),e("span",{attrs:{slot:"close"},slot:"close"},[t._v("禁用")])])],1)],1),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("Button",{attrs:{type:"text"},on:{click:function(e){t.menuModalVisible=!1}}},[t._v("取消")]),e("Button",{attrs:{type:"primary",loading:t.submitLoading},on:{click:t.submitAdd}},[t._v("提交")])],1)],1)],1)},r=[],i=s(7184);const a=t=>(0,i.j0)("/permission/add",t),l=t=>(0,i.j0)("/permission/edit",t),n=t=>(0,i.j0)("/permission/delByIds",t),m=t=>(0,i.A_)("/permission/search",t),d=(t,e)=>(0,i.A_)(`/dictData/getByType/${t}`,e),c=t=>(0,i.A_)("/permission/getUserByPermission",t);var p=s(3329),h=s(7792);const u={name:"menu",components:{IconChoose:p["default"]},data(){return{userByPermissionLoading:!1,loading:!0,strict:!0,maxHeight:500,menuModalVisible:!1,iconModalVisible:!1,selectList:[],selectCount:0,showParent:!1,searchKey:"",parentTitle:"",editTitle:"",modalTitle:"",form:{id:"",title:"",name:"",icon:"",path:"",component:"",parentId:"",buttonType:"",type:0,sortOrder:0,level:0,status:0,url:""},formAdd:{buttonType:""},formValidate:{title:[{required:!0,message:"菜单名称不能为空",trigger:"blur"}],name:[{required:!0,message:"路由英文名不能为空",trigger:"blur"}],icon:[{required:!0,message:"图标不能为空",trigger:"click"}],path:[{required:!0,message:"路径不能为空",trigger:"blur"}],component:[{required:!0,message:"对应位置不能为空",trigger:"blur"}],sortOrder:[{required:!0,type:"number",message:"排序值不能为空",trigger:"blur"}]},submitLoading:!1,data:[],dictPermissions:[],userByPermissionList:[],userByPermissionColumns:[{title:"用户名",key:"userName",minWidth:120,tooltip:!0,sortable:!1},{title:"对应角色",key:"roleStr",minWidth:200,tooltip:!0,sortable:!1},{title:"登录账号",key:"code",minWidth:120,tooltip:!0,sortable:!1},{title:"用户手机",key:"mobile",minWidth:120,tooltip:!0,sortable:!1},{title:"用户标识",key:"userId",minWidth:120,tooltip:!0,sortable:!1}]}},methods:{init(){this.getPermissionList(),this.getDictPermissions()},changeFormPath(){this.form.name=this.form.path},changeFormName(){this.form.path=this.form.name},getDictPermissions(){d("permission_type").then((t=>{t.success&&(this.dictPermissions=t.result)}))},renderContent(t,{root:e,node:s,data:o}){let r="";return r=0==o.level?"ios-navigate":1==o.level?"md-list-box":2==o.level?"md-list":3==o.level?"md-radio-button-on":"md-radio-button-off",t("span",[t("span",[t("Icon",{props:{type:r,size:"16"},style:{"margin-right":"8px","margin-bottom":"3px"}}),t("span",o.title)])])},getPermissionList(){this.loading=!0,this.getRequest("/permission/getAllList").then((t=>{this.loading=!1,t.success&&(this.data=t.result)}))},search(){this.searchKey?(this.loading=!0,m({title:this.searchKey}).then((t=>{this.loading=!1,t.success&&(this.data=t.result)}))):this.getPermissionList()},selectTree(t){if(t.length>0){for(let o in t[0])null==t[0][o]&&(t[0][o]="");let e=JSON.stringify(t[0]),s=JSON.parse(e);this.form=s,this.editTitle=s.title,this.getUserByPermission()}else this.cancelEdit(),this.userByPermissionList=[]},getUserByPermission(){var t=this;t.userByPermissionLoading=!0,c({permissionId:t.form.id}).then((e=>{t.userByPermissionLoading=!1,e.success&&(t.userByPermissionList=e.result)}))},cancelEdit(){let t=this.$refs.tree.getSelectedNodes()[0];t&&(t.selected=!1),this.$refs.form.resetFields(),this.form.id="",this.editTitle=""},handleReset(){let t=this.form.type;this.$refs.form.resetFields(),this.form.icon="",this.form.component="",this.form.type=t},submitEdit(){this.form.id?(this.submitLoading=!0,null==this.form.sortOrder&&(this.form.sortOrder=""),null==this.form.buttonType&&(this.form.buttonType=""),1==this.form.type&&(this.form.name="",this.form.icon="",this.form.component=""),delete this.form.updateTime,delete this.form.children,l(this.form).then((t=>{this.submitLoading=!1,t.success&&(this.$Message.success("编辑成功"),this.$store.commit("setAdded",!1),h.ZP.initRouter(this),this.init(),this.menuModalVisible=!1)}))):this.$Message.warning("请先点击选择要修改的菜单节点")},submitAdd(){this.$refs.formAdd.validate((t=>{t&&(this.submitLoading=!0,1==this.formAdd.type&&(this.formAdd.name="",this.formAdd.icon="",this.formAdd.component=""),a(this.formAdd).then((t=>{this.submitLoading=!1,t.success&&(this.$Message.success("添加成功"),this.$store.commit("setAdded",!1),h.ZP.initRouter(this),this.init(),this.menuModalVisible=!1)})))}))},addMenu(){if(!this.form.id)return this.modalTitle="添加顶部菜单(可拖动)",this.showParent=!1,this.formAdd={type:-1,level:0,sortOrder:0,status:0},void(this.menuModalVisible=!0);this.parentTitle=this.form.title,this.modalTitle="添加子节点",this.showParent=!0;let t=0;if(1==this.form.level)t=0;else if(2==this.form.level)t=1;else{if(3==this.form.level)return void this.$Modal.warning({title:"抱歉，不能添加啦",content:"仅支持2级菜单目录"});t=0}this.formAdd={icon:"",type:t,parentId:this.form.id,level:Number(this.form.level)+1,sortOrder:0,buttonType:"",status:0},0==this.form.level?(this.formAdd.path="/",this.formAdd.component="Main"):2==this.form.level&&(this.formAdd.path="无"),this.menuModalVisible=!0},changeSelect(t){this.selectCount=t.length,this.selectList=t},deletePermissionFx(){this.selectCount<=0?this.$Message.warning("请选择要删除的菜单"):this.$Modal.confirm({title:"确认删除",content:"您确认要删除所选的 "+this.selectCount+" 条数据?",loading:!0,onOk:()=>{let t="";this.selectList.forEach((function(e){t+=e.id+","})),t=t.substring(0,t.length-1),n({ids:t}).then((t=>{this.$Modal.remove(),t.success&&(this.$Message.success("删除成功"),this.$store.commit("setAdded",!1),h.ZP.initRouter(this),this.selectList=[],this.selectCount=0,this.cancelEdit(),this.init())}))}})}},mounted(){let t=document.documentElement.clientHeight;this.maxHeight=Number(t-260),this.init()}},f=u;var v=s(1001),y=(0,v.Z)(f,o,r,!1,null,null,null);const b=y.exports}}]);